<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>莫氏金流商匯 | ws鍠</title>
    <style>
        body { font-family: Arial, sans-serif;background: linear-gradient(145deg, #a8a8a8, #000000);color: #ecf0f1;padding: 20px; }
        h1 { text-align: center;margin-bottom: 20px;font-size: 2em;text-shadow: 2px 2px 4px gold; }
        .container { max-width: 600px;margin: 0 auto;padding: 20px;border-radius: 12px;background: #2f3030;box-shadow: 4px 4px 8px #767676; }
        label, p { margin: 10px 0 5px; }
        input, textarea, button { margin-bottom: 10px;padding: 8px;border-radius: 8px;border: none;outline: none; }
        input, textarea { width: 100%; }
        .大鍵 {border-radius: 10px; background: #282828;color: #bdbdbd;box-shadow: inset 25px 25px 50px rgba(139, 139, 139, 0.8);border: 1px solid #686868;font-size: 48px;width: 100%; }
        .大鍵:hover { background: #484949; }
        button { background-color: #000000;color: white;cursor: pointer; }
        button:hover { background-color: #484949; }
        .hidden { display: none; }
        .reply-group { margin-bottom: 15px;position: relative; }
        .delete-btn { position: absolute;right: -15px;top: 35%;transform: translateY(-50%);width: 30px;height: 30px;background-color: #444;color: white;border-radius: 50%;display: flex;align-items: center;justify-content: center;font-size: 16px;padding: 0; }
        .delete-btn:hover { background-color: #777; }
        .reply-container { display: flex;align-items: center;gap: 10px; }
        .reply-inputs { flex-grow: 1; }



    </style>

  <!-- ws icon https://www.thinkcmf.com/font/font_awesome/icons.html -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://64071181.github.io/mokJsapi/a.js">//琪琪修改</script>
  <script src="https://cdn.staticfile.net/translate.js/3.1.7/translate.js">// 翻譯 放最後</script>

</head>







































<body>
    <samp id="莫生查詢" style="display: none;">莫生我要查詢whatsapp自動回覆程式</samp>

    <h1><a href="./"><b id="_我司名"></b> | ws鍠</a></h1>
    <p class="mokJsApi_copyright">版權</p>


    









    <div class="container" style="padding: 20px;">
        <p id="更新日期">202504160205</p>
        <iframe width="100%" height="315" src="https://www.youtube.com/embed/dBTxzLg-eFA?si=PTpM-9-b3_jeVNB6" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    </div>










    <div  class="container" style="padding: 20px;">
        
            <!-- 部份1: 帳號 -->
            <label>手機地區號</label>
            <input id="regionCode" type="text" placeholder="例如: 86" title="例如: 86" required>
            <label>WhatsApp 號碼</label>
            <input id="whatsappNumber" type="text" placeholder="輸入WhatsApp號碼" title="輸入WhatsApp號碼" required>

            <!-- 部份2: 回覆內容 -->
            <h3>回覆內容</h3>
            <samp>不能用表情符號</samp>
            
            <div id="replies"></div>
            <button onclick="addReply()">增加回覆內容</button>
            
            <samp style="float: right;">
            <button onclick="下載設定檔()">⬇️ 下載設定檔</button>
            <input type="file" id="uploadInput" style="display: none;" accept=".json" onchange="上傳設定檔(event)">
            <button onclick="document.getElementById('uploadInput').click()">⬆️ 上傳設定檔</button>
        </samp>        

            <!-- 部份3: 登入流程_xpaths -->
            <div id="xpaths" class="hidden">
                <p id="loginXpaths">
# 必須按此排列
'使用手機號碼登入':'//*[@id="app"]/div/div[2]/div[2]/div[*]/div/div/div[2]/div[1]/div[5]/span/div',
'国家选择':'//*[@id="app"]/div/div[2]/div[2]/div[*]/div/div/div[3]/div[1]/div[1]/button/div/div/div',
'国家代码':'//*[@id="wa-popovers-bucket"]/div/div[2]/div/div[1]/div/div[2]/div/div/p',
'地区选择':'//*[@id="wa-popovers-bucket"]/div/div[2]/div/div[2]/div/div/div/div/div/div/button/div/div/div[2]/div/div/div',
'电话号码':'//*[@id="app"]/div/div[2]/div[2]/div[*]/div/div/div[3]/div[1]/div[2]/div/div/div/form/input',
'登入按钮':'//*[@id="app"]/div/div[2]/div[2]/div[*]/div/div/div[3]/div[3]/button/div/div'
                </p>

                <!-- 部份4: 其他_xpaths -->
                <p id="otherXpaths">
'验证成功使用QR碼登入消失':'//*[@id="app"]/div/div[2]/div[2]/div[2]/div/div/div[7]/span/div',
'验证字符頭':'//*[@id="app"]/div/div[2]/div[2]/div[*]/div/div/div[4]/div/div/div/div[',
'验证字符尾':']/span',
'對話列表':'//*[@id="pane-side"]/div[*]/div/div',
'客戶信息位':'.//div/div/div/div[2]/div[2]/div[1]/span/span',
'對話輸入框':'//*[@id="main"]/footer/div[1]/div/span/div/div[2]/div[1]/div[2]/div[*]/p'
                </p>
            </div>

            <!-- 部份5: _顯示聯莫 -->
            <div id="ContactAKI" class="ContactAKI"><!-- JS _顯示聯莫 --></div>
            <br>

            <!-- 部份6: 執行ws鍠 -->
            <button class="大鍵 執行ws鍠" style="display: none;" title="執行ws鍠" onclick="執行ws鍠()">執行ws鍠</button>


    </div>














































    <script>
        function saveToLocalStorage(key, value) {
            localStorage.setItem(key, value);
        }

        function loadFromLocalStorage(key) {
            return localStorage.getItem(key);
        }

        // 如果 localStorage 中沒有 回覆內容 數據，添加三組預設回覆
        function _添加預設回覆() {
            const savedReplies = JSON.parse(localStorage.getItem('replies') || '{}');
            
            if (Object.keys(savedReplies).length === 0) {
                
                const defaultReplies = [
                    { text: "hi", response: "您好！請問有什麼可以幫您？" },
                    { text: "你好", response: "您好，歡迎聯絡客服，請說明您的需求。" },
                    { text: "謝謝", response: "不客氣，這是我們應該做的。" }
                ];
                
                // 添加預設回覆到頁面
                defaultReplies.forEach(reply => {
                    addReply(reply.text, reply.response);
                });
                
                // 保存預設回覆到 localStorage
                const repliesToSave = {};
                defaultReplies.forEach(reply => {
                    repliesToSave[reply.text] = reply.response;
                });
                localStorage.setItem('replies', JSON.stringify(repliesToSave));
            } 
        }


        function addReply(text = '', response = '') {
            const replies = document.getElementById('replies');
            const replyGroup = document.createElement('div');
            replyGroup.classList.add('reply-group');
            
            replyGroup.innerHTML = `
                <div class="reply-container">
                    <div class="reply-inputs">
                        <input placeholder="當客戶說..." title="當客戶說" value="${text}">
                        <textarea placeholder="自動回覆..." title="自動回覆">${response}</textarea>
                    </div>
                    <button class="delete-btn" onclick="deleteReply(this)">×</button>
                </div>
            `;
            replies.appendChild(replyGroup);
        }

        function deleteReply(button) {
            const replyGroup = button.closest('.reply-group');
            if (replyGroup && confirm('確定要刪除這組回覆嗎？')) {
                replyGroup.remove();
            }
        }









        function 下載設定檔() {
            const regionCode = document.getElementById('regionCode').value;
            const whatsappNumber = document.getElementById('whatsappNumber').value;

            const replyGroups = document.querySelectorAll('.reply-group');
            const replies = {};
            replyGroups.forEach(group => {
                const text = group.querySelector('input').value;
                const response = group.querySelector('textarea').value;
                if (text && response) {
                    replies[text] = response;
                }
            });

            const data = {
                regionCode,
                whatsappNumber,
                replies
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement("a");
            link.href = url;
            link.download = "whatsapp_設定檔.json";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function 上傳設定檔(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);

                    // 匯入值
                    document.getElementById('regionCode').value = data.regionCode || '';
                    document.getElementById('whatsappNumber').value = data.whatsappNumber || '';

                    // 清空舊的回覆
                    document.getElementById('replies').innerHTML = '';

                    // 加入新的回覆
                    const replies = data.replies || {};
                    Object.keys(replies).forEach(key => {
                        addReply(key, replies[key]);
                    });

                    alert("設定檔已成功匯入！");
                } catch (error) {
                    alert("檔案格式錯誤或解析失敗");
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }












        async function 執行ws鍠() {
            const regionCode = document.getElementById('regionCode').value;
            const whatsappNumber = document.getElementById('whatsappNumber').value;
            const loginXpaths = document.getElementById('loginXpaths').textContent.trim();
            const otherXpaths = document.getElementById('otherXpaths').textContent.trim();

            const replyGroups = document.querySelectorAll('.reply-group');
            const replies = {};
            replyGroups.forEach(group => {
                const text = group.querySelector('input').value;
                const response = group.querySelector('textarea').value;
                if (text && response) {
                    replies[text] = response;
                }
            });

            const hashValue = await sha256_for帳號1181(regionCode + whatsappNumber);

            // 必須保留2行空白
            const 執行碼 = `帳號1181 = "${hashValue}"
国家代码 = "${regionCode}"
电话号码 = "${whatsappNumber}"
回覆內容 = ${JSON.stringify(replies, null, 2)}
登入流程_xpaths = {${loginXpaths || '無'}}
其他_xpaths = {${otherXpaths || '無'}}


`; 
            navigator.clipboard.writeText(執行碼);
            // py 檢查 剪贴板 轉變執行
        }

        async function sha256_for帳號1181(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        function loadSavedData() {
            document.getElementById('regionCode').value = loadFromLocalStorage('regionCode') || '';
            document.getElementById('whatsappNumber').value = loadFromLocalStorage('whatsappNumber') || '';

            let savedLoginXpaths = loadFromLocalStorage('loginXpaths');
            const loginXpathElem = document.getElementById('loginXpaths');
            if (!savedLoginXpaths || savedLoginXpaths.trim() === '') {
                savedLoginXpaths = loginXpathElem.textContent.trim();
                saveToLocalStorage('loginXpaths', savedLoginXpaths);
            }

            let savedOtherXpaths = loadFromLocalStorage('otherXpaths');
            const otherXpathElem = document.getElementById('otherXpaths');
            if (!savedOtherXpaths || savedOtherXpaths.trim() === '') {
                savedOtherXpaths = otherXpathElem.textContent.trim();
                saveToLocalStorage('otherXpaths', savedOtherXpaths);
            }

            const savedReplies = JSON.parse(loadFromLocalStorage('replies') || '{}');
            Object.keys(savedReplies).forEach(key => {
                addReply(key, savedReplies[key]);
            });
        }

        window.addEventListener('beforeunload', () => {
            const replyGroups = document.querySelectorAll('.reply-group');
            const replies = {};
            replyGroups.forEach(group => {
                const text = group.querySelector('input').value;
                const response = group.querySelector('textarea').value;
                if (text && response) {
                    replies[text] = response;
                }
            });

            saveToLocalStorage('regionCode', document.getElementById('regionCode').value);
            saveToLocalStorage('whatsappNumber', document.getElementById('whatsappNumber').value);
            saveToLocalStorage('loginXpaths', document.getElementById('loginXpaths').textContent);
            saveToLocalStorage('otherXpaths', document.getElementById('otherXpaths').textContent);
            saveToLocalStorage('replies', JSON.stringify(replies));
        });




        /* ********************* */
        function _翻譯(){ 
            translate.service.use('client.edge'); //設置機器翻譯服務通道，直接客戶端本身，不依賴服務端 。相關說明參考 http://translate.zvo.cn/43086.html
            translate.execute();//進行翻譯 
        }

        // 等待頁面完全加載 
        window.onload = function() {
            // 再顯示按鈕
            document.querySelector('.執行ws鍠').style.display = 'inline-block';
            _添加預設回覆();
        };

        function Start() {
            // 顯示聯莫
            const 聯莫 = ['moksurky@gmail.com','https://wa.me/85264071181/','https://i.meee.com.tw/atcX6QM.png','https://www.instagram.com/moksurky2025/','https://line.me/ti/p/UlSPd7p9zh/','https://www.facebook.com/aki.mok.10/','http://t.me/mokaki/'
            ];
            _翻譯()
            _顯示聯莫(聯莫);
            
            loadSavedData();
        }

        琪琪修改()

        

    </script>
</body>
</html>