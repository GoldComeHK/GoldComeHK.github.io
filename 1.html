














<!-- 
      :::    :::       ::::::::::           :::        :::::::::
     :+:    :+:       :+:                :+: :+:      :+:    :+:
    +:+    +:+       +:+               +:+   +:+     +:+    +:+
   +#++:++#++       +#++:++#         +#++:++#++:    +#+    +:+
  +#+    +#+       +#+              +#+     +#+    +#+    +#+
 #+#    #+#       #+#              #+#     #+#    #+#    #+#
###    ###       ##########       ###     ###    #########
-->


<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搵客鍠🔍 | 金come</title>
    <style>
        body { font-family: Arial, sans-serif;background: linear-gradient(145deg, #a8a8a8, #000000);color: #ecf0f1;padding: 20px; }
        h1 { text-align: center;margin-bottom: 20px;font-size: 2em;text-shadow: 2px 2px 4px gold; }
        .container { max-width: 600px;margin: 0 auto;padding: 20px;border-radius: 12px;background: #2f3030;box-shadow: 4px 4px 8px #767676; }
        label, p { margin: 10px 0 5px; }
        input, textarea, select, button { margin-bottom: 10px;padding: 8px;border-radius: 8px;border: none;outline: none; }
        input, textarea, select { width: 100%; }
        .大鍵 {border-radius: 10px; background: #282828;color: #bdbdbd;box-shadow: inset 25px 25px 50px rgba(139, 139, 139, 0.8);border: 1px solid #686868;font-size: 48px;width: 100%; }
        .大鍵:hover { background: #484949; }
        button { background-color: #000000;color: white;cursor: pointer; }
        button:hover { background-color: #484949; }
        
        .reply-group { margin-bottom: 15px;position: relative; }
        .delete-btn { position: absolute;right: -15px;top: 35%;transform: translateY(-50%);width: 30px;height: 30px;background-color: #444;color: white;border-radius: 50%;display: flex;align-items: center;justify-content: center;font-size: 16px;padding: 0; }
        .delete-btn:hover { background-color: #777; }
        .reply-container { display: flex;align-items: center;gap: 10px; }
        .reply-inputs { flex-grow: 1; }
        .hidden,#uploadInput,.執行金come { display: none; }
        .執行金come{place-items: center;}
    </style>

  <!-- ws icon https://www.thinkcmf.com/font/font_awesome/icons.html -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="../mokJsapi/a.js">//琪琪修改</script>
  <script src="py/py.js"></script>

  <link rel="stylesheet" href="html.css">
  <script src="html.js"></script>
  <script type="module" src="login.js"></script>

  <script src="https://cdn.staticfile.net/translate.js/3.1.7/translate.js">// 翻譯 放最後</script>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>













    











<!-- 
  :::::::::::       :::    :::   :::::::::::
     :+:           :+:    :+:       :+:
    +:+            +:+  +:+        +:+
   +#+             +#++:+         +#+
  +#+            +#+  +#+        +#+
 #+#           #+#    #+#       #+#
###           ###    ###       ###
-->
    <samp id="莫生查詢" style="display: none;">莫生我要查詢搵客鍠使用問題</samp>

    <samp id="匯入警告" style="display: none;">匯入設定檔會刪除現時設定！</samp>
    <samp id="設定匯入" style="display: none;">設定檔已成功匯入！</samp>
    <samp id="設定格式錯誤" style="display: none;">檔案格式錯誤或解析失敗</samp>
















    <!-- 部份0: 基本 -->
    <div id="執行中請不要關閉網頁">
        <h2>🙂 = <span class="user-email"></span></h2>
        <h2>💰 = <span class="user-score"  title="悠的點數" >0</span></h2>
        <h2 id="執行中說明">請稍候...</h2>
    </div>
    <h1>搵客鍠🔍 | <a href="./set.html"><b class="_我司名"></b></a></h1>
    <p class="mokJsApi_copyright">版權</p>
    <div id="導航" ><!-- JS 導航 --></div>



    <div class="container" style="padding: 20px;">
        
            <!-- 部份1: 帳號 -->

            <!-- 部份2: setting -->
            <div class="reply-group">
                
                <label tabindex="0">請選擇搜尋地區* ❔<b class="說明">需要在當地網絡才能搜尋</b></label>
                <select id="地區" class="記錄數據用" title="請選擇搜尋地區">
                    <option value="HK" selected>香港</option>
                    <option value="TW">台灣</option>
                </select>

                <label tabindex="0">請填寫搜尋關鍵字 ❔<b class="說明">不填寫將直接搜尋所有最新資料</b></label>
                <input id="關鍵字" class="記錄數據用" type="text" placeholder="請填寫搜尋關鍵字" title="請填寫搜尋關鍵字" value="金融">
            
                <label tabindex="0">最多找資料數 (1資料 = 1💰) ❔<b class="說明">愈多需時愈久，最大1000 <br>(只會獲取最新資料，最好3至5天用一次，短時間重複使用可能會重複收到相同資料)。</b></label>
                <input id="最多找資料數" class="記錄數據用" value="10" type="number" min="1" max="1000" step="1" required oninput="this.value = this.value.replace(/[^0-9]/g, '');">
            

                <button id="保存" style="margin-top:10px;">保存</button>
            </div>

            <!-- 部份3: 結果 -->
            <textarea id="搵客鍠結果" class="記錄數據用" ></textarea>
            <p id="臨時結果"></p>



            <!-- 部份4: 設定檔 -->
            <samp style="float: right;">
                <button onclick="下載設定檔()">⬇️ 下載設定檔</button>
                <input type="file" id="uploadInput" accept=".json" onchange="上傳設定檔(event)">
                <button onclick="document.getElementById('uploadInput').click()">⬆️ 上傳設定檔</button>
            </samp>        



            <!-- 部份5: _顯示聯莫 -->
            <div id="ContactAKI" class="ContactAKI"><!-- JS _顯示聯莫 --></div>
            <br>

            <!-- 部份6: 執行金come -->
            <div class="執行金come">


                <!-- Google 登入 -->
                <div id="login-form">     
                    <button onclick="loginWithGoogle()" class="大鍵" >Google 登入</button>
                    <div id="error-message" class="error"></div>
                </div>
                <div id="admin-panel" style="display: none;"></div>
                <div id="user-info" style="display: none;">
                    <button onclick="充值()" title="充值" >💰 = </button>
                    <span class="user-score"  title="悠的點數" >0</span>
                    🙂 = <span class="user-email"></span>
                    <button onclick="logout()">登出</button>
                    <div id="success-message" class="success"></div>
                    <div id="db-error-message" class="error"></div>

                    <button class="大鍵"  title="執行搵客鍠 🔍" onclick="執行搵客鍠()">執行搵客鍠 🔍</button>
                    <div id="login-history"></div>
                </div><!-- Google 登入 -->


                <!-- qqqq --><button id="限本機" style="display: none;" title="執行搵客鍠 🔍" onclick="執行搵客鍠(1)">admin 搵客鍠 🔍</button>
                <h3><a href="./set.html">返回<b class="_我司名"></b></a></h3>
            </div>



            <div class="scroll-top" id="scrollTop" onclick="scrollToTop()">↑</div>

    </div>
































    <script>
        /*
              ::::::::           :::     :::     :::       ::::::::::       :::::::::
            :+:    :+:        :+: :+:   :+:     :+:       :+:              :+:    :+:
           +:+              +:+   +:+  +:+     +:+       +:+              +:+    +:+
          +#++:++#++      +#++:++#++: +#+     +:+       +#++:++#         +#+    +:+
                +#+      +#+     +#+  +#+   +#+        +#+              +#+    +#+
        #+#    #+#      #+#     #+#   #+#+#+#         #+#              #+#    #+#
        ########       ###     ###     ###           ##########       #########
        */        
        
                const 記錄位 = document.querySelectorAll(".記錄數據用");
        
                function 記錄已填寫數據() {
                    // 頁面加載時，從 LocalStorage 恢復數據
                    document.addEventListener("DOMContentLoaded", () => {
                        // 從 localStorage 恢復數據
                        記錄位.forEach(element => {
                        const savedValue = localStorage.getItem(element.id);
                        if (savedValue !== null) {
                            element.value = savedValue; // 適用於 input、textarea、select
                        }
                        });
                    });
        
                    // 實時保存輸入數據
                    記錄位.forEach(element => {
                        element.addEventListener("input", () => {
                        localStorage.setItem(element.id, element.value);
                        });
                    });

                    // 在頁面卸載前強制保存所有數據
                    window.addEventListener('beforeunload', () => {
                        記錄位.forEach(element => {
                            localStorage.setItem(element.id, element.value);
                        });
                    });
        }
        
        

























/*
      :::::::::       ::::::::     :::       :::       ::::    :::       :::        ::::::::           :::        :::::::::
     :+:    :+:     :+:    :+:    :+:       :+:       :+:+:   :+:       :+:       :+:    :+:        :+: :+:      :+:    :+:
    +:+    +:+     +:+    +:+    +:+       +:+       :+:+:+  +:+       +:+       +:+    +:+       +:+   +:+     +:+    +:+
   +#+    +:+     +#+    +:+    +#+  +:+  +#+       +#+ +:+ +#+       +#+       +#+    +:+      +#++:++#++:    +#+    +:+
  +#+    +#+     +#+    +#+    +#+ +#+#+ +#+       +#+  +#+#+#       +#+       +#+    +#+      +#+     +#+    +#+    +#+
 #+#    #+#     #+#    #+#     #+#+# #+#+#        #+#   #+#+#       #+#       #+#    #+#      #+#     #+#    #+#    #+#
#########       ########       ###   ###         ###    ####       ########## ########       ###     ###    #########

*/
        // 手動上下載
        function 下載設定檔() {
            const 記錄位B = document.querySelectorAll(".記錄數據用");
            const data = {};
            // 遍歷所有帶有 .記錄數據用 類的元素
            記錄位B.forEach(element => {
                // 使用元素的 id 作為鍵，如果沒有 id 則使用 name 或其他屬性
                const key = element.id || element.name || element.className;
                if (key) {
                    data[key] = element.value || '';
                }
            });

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement("a");
            link.href = url;
            link.download = `${_現在時間()}_遠端鍠.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }


















        function 上傳設定檔(event) {
            const 設定匯入 = document.getElementById('設定匯入').textContent;
            const 設定格式錯誤 = document.getElementById('設定格式錯誤').textContent;
            const 匯入警告 = document.getElementById('匯入警告').textContent;
            
            if (!confirm(匯入警告)) {
                location.reload(); 
                return;
            }

            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // 遍歷所有 .記錄數據用 元素並導入數據
                    記錄位.forEach(element => {
                        const key = element.id || element.name || element.className;
                        if (key && importedData.hasOwnProperty(key)) {
                            element.value = importedData[key] || '';
                        }
                    });

                    alert(設定匯入);
                } catch (error) {
                    alert(設定格式錯誤);
                    console.error("解析错误:", error);
                }
            };
            reader.readAsText(file);
        }




























/*
      :::::::::       ::::::::::       ::::::::      :::    :::       :::    :::::::::::
     :+:    :+:      :+:             :+:    :+:     :+:    :+:       :+:        :+:
    +:+    +:+      +:+             +:+            +:+    +:+       +:+        +:+
   +#++:++#:       +#++:++#        +#++:++#++     +#+    +:+       +#+        +#+
  +#+    +#+      +#+                    +#+     +#+    +#+       +#+        +#+
 #+#    #+#      #+#             #+#    #+#     #+#    #+#       #+#        #+#
###    ###      ##########       ########       ########        ########## ###
*/

/*
        // 監聽臨時結果元素的變化
        const 臨時結果 = document.getElementById("臨時結果");
        const 搵客鍠結果 = document.getElementById("搵客鍠結果");

        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (臨時結果.innerHTML.trim() !== "") {  // 改用innerHTML
                    // 將<br>轉換為換行符
                    const 格式化內容 = 臨時結果.innerHTML
                        .replace(/<br\s*\/?>/gi, "\n")  // 處理普通<br>
                        .replace(/<\/?[^>]+(>|$)/g, ""); // 移除其他HTML標籤（可選）
                    
                    搵客鍠結果.value = 格式化內容 + "\n" + 搵客鍠結果.value;
                    臨時結果.innerHTML = ""; // 用innerHTML清空
                }
            });
        });

        // 開始觀察臨時結果元素的子節點和文本內容變化
        observer.observe(臨時結果, {
            childList: true,
            characterData: true,
            subtree: true
        });
*/


        // <textarea> 根据内容自动显示/隐藏
        //const resultTextarea = document.getElementById('搵客鍠結果');
        // 内容变化监听函数
        function toggleVisibility() {
            //const hasContent = resultTextarea.value.trim().length > 0;
            // 使用 classList 切换样式
            //resultTextarea.classList.toggle('hidden', !hasContent);
            document.querySelector('#執行中請不要關閉網頁').style.display = 'none';
        }
        // 事件监听（兼容现代浏览器）
        //resultTextarea.addEventListener('input', toggleVisibility);
        //resultTextarea.addEventListener('paste', toggleVisibility);  // 处理粘贴操作
        //resultTextarea.addEventListener('cut', toggleVisibility);    // 处理剪切操作
        // 初始化检查
        toggleVisibility();
        // 可选：处理页面加载后的动态内容注入
        window.addEventListener('load', function() {
        // 如果通过其他方式加载内容需要再次检查
        toggleVisibility();
        });






























/*
      :::::::::      :::    :::       ::::    :::                       ::::::::::       :::    :::       ::::::::::
     :+:    :+:     :+:    :+:       :+:+:   :+:                       :+:              :+:    :+:       :+:
    +:+    +:+     +:+    +:+       :+:+:+  +:+                       +:+               +:+  +:+        +:+
   +#++:++#:      +#+    +:+       +#+ +:+ +#+                       +#++:++#           +#++:+         +#++:++#
  +#+    +#+     +#+    +#+       +#+  +#+#+#                       +#+               +#+  +#+        +#+
 #+#    #+#     #+#    #+#       #+#   #+#+#                       #+#              #+#    #+#       #+#
###    ###      ########        ###    ####       ##########      ##########       ###    ###       ##########

*/
        /* ********************* */
        async function 執行搵客鍠(sel='') {
            if (sel == 1 && !_主機檢查()) return; //qqqq

            const 關鍵字 = document.getElementById('關鍵字').value;
            const 地區 = document.getElementById('地區').value;
            const 最多找資料數 = document.getElementById('最多找資料數').value;
            const 搵客鍠py = `搜${地區}`

            // 要齊料岩料
            if (最多找資料數 < 1) {alert('最多找資料數不能為零!');return;}
            // 先齊必填
            const 要齊料 = {
                地區: 地區,
                最多找資料數:最多找資料數
            };
            for (const 欄位 of Object.keys(要齊料)) {
                if (要齊料[欄位] == null || 要齊料[欄位] === '') {alert(`${欄位} 沒填寫!`);return;}
            }

            // 按地區選py code
            const 變數庫 = {
                搜HK: 搜HK,
                搜TW: 搜TW,
            };


            // 檢查分數
            使用分數 = 最多找資料數
            const result = await redeemPoints(使用分數); // 接收 redeemPoints() 的返回值
            //qqqq
            if (sel !== 1 && !result.success) {
                alert(`您的分數不足${使用分數}點，請充值!`);
                充值();
                return;
            }

            const 執行碼 = 變數庫[搵客鍠py]
            .replace(/@關鍵字@/g, 關鍵字)
            .replace('@找幾料@', 最多找資料數);
            navigator.clipboard.writeText(執行碼);

            document.querySelector('#執行中請不要關閉網頁').style.display = 'flex';
            // py 檢查 剪贴板 轉變執行
        }
        /* ********************* */





















/*
          :::        :::    :::       :::::::::::
       :+: :+:      :+:   :+:            :+:
     +:+   +:+     +:+  +:+             +:+
   +#++:++#++:    +#++:++              +#+
  +#+     +#+    +#+  +#+             +#+
 #+#     #+#    #+#   #+#            #+#
###     ###    ###    ###       ###########
*/

        function _主機檢查() {
            // 定義本地文件基礎路徑（注意：使用解碼後的中文字符）
            const basePath = 'file:///C:/Users/mokaki/Desktop/%E9%87%91/%E9%87%91come(2025)/GoldComeHK.github.io/';            
            // 檢查當前 URL 是否以基礎路徑開頭
            if (window.location.href.startsWith(basePath)) {
                document.getElementById('限本機').style.display = 'block';
                return true;
            }
        }

        function _現在時間() {
            const now = new Date();
            return [
                now.getFullYear(),
                String(now.getMonth() + 1).padStart(2, '0'),
                String(now.getDate()).padStart(2, '0'),
                String(now.getHours()).padStart(2, '0'),
                String(now.getMinutes()).padStart(2, '0'),
                String(now.getSeconds()).padStart(2, '0')
            ].join('');
        }




        function _翻譯(){ 
            translate.service.use('client.edge'); //設置機器翻譯服務通道，直接客戶端本身，不依賴服務端 。相關說明參考 http://translate.zvo.cn/43086.html
            translate.execute();//進行翻譯 
        }
        // 等待頁面完全加載 
        window.onload = function() {
            // 再顯示按鈕
            document.querySelector('.執行金come').style.display = 'grid';
            document.querySelector("#執行中請不要關閉網頁").style.display = "none";
        };
        function Start() {
            // 顯示聯莫
            const 聯莫 = ['moksurky@gmail.com','https://wa.me/85264071181/','https://i.meee.com.tw/atcX6QM.png','https://www.instagram.com/moksurky2025/','https://line.me/ti/p/UlSPd7p9zh/','https://www.facebook.com/aki.mok.10/','http://t.me/mokaki/','https://github.com/GoldComeHK/GoldComeHK.github.io'
            ];
            _翻譯()
            _顯示聯莫(聯莫);
            _主機檢查();// qqqq
            
            
        }
        記錄已填寫數據();
        琪琪修改()
            // Firebase SDK
            var script1 = document.createElement('script');
            script1.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
            document.head.appendChild(script1);
            var script2 = document.createElement('script');
            script2.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";
            document.head.appendChild(script2);

            // 等待 SDK 載入
            function waitForFirebase(cb) {
                if (window.firebase && window.firebase.firestore) cb();
                else setTimeout(() => waitForFirebase(cb), 100);
            }

            waitForFirebase(function() {
                firebase.initializeApp(window.firebaseConfig);
                const db = firebase.firestore();

                // 用戶ID請根據登入狀態取得，這裡暫用 guest
                let userId = null;
if (firebase.auth().currentUser) {
  userId = firebase.auth().currentUser.uid;
} else {
  // 未登入時可提示或導向登入
  alert('請先登入');
  return;
}

                // 監聽關鍵字輸入
                document.getElementById('關鍵字').addEventListener('change', async function() {
                    const keyword = this.value.trim();
                    if (!keyword) return;
                    const docRef = db.collection('users').doc(userId).collection('fun1').doc(keyword);
                    const doc = await docRef.get();
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('地區').value = data.地區 || '';
                        document.getElementById('最多找資料數').value = data.找資料數 || '';
                        document.getElementById('搵客鍠結果').value = data.搵客鍠結果 || '';
                    }
                    // 沒有資料則不動
                });

                // 保存按鈕
                // 若已存在則覆蓋
                if (!document.getElementById('保存')) {
                    var btn = document.createElement('button');
                    btn.id = '保存';
                    btn.innerText = '保存';
                    document.querySelector('.reply-group').appendChild(btn);
                }
                document.getElementById('保存').addEventListener('click', async function() {
                    const keyword = document.getElementById('關鍵字').value.trim();
                    const 地區 = document.getElementById('地區').value;
                    const 找資料數 = document.getElementById('最多找資料數').value;
                    const 搵客鍠結果 = document.getElementById('搵客鍠結果').value;
                       console.log('保存按鈕點擊', { keyword, 地區, 找資料數, 搵客鍠結果, userId });
                    if (!keyword) {
                        alert('請輸入關鍵字');
                           showSaveMsg('請輸入關鍵字', true);
                        return;
                    }
                       if (!userId) {
                           showSaveMsg('未登入，請先登入再保存', true);
                           console.error('userId 為空，無法保存');
                           return;
                       }
                        try {
                           showSaveMsg('正在保存...', false);
                            await db.collection('users').doc(userId).collection('fun1').doc(keyword).set({
                                地區,
                                找資料數,
                                搵客鍠結果
                            });
                            showSaveMsg('已保存', false);
                           console.log('保存成功');
                        } catch (err) {
                            showSaveMsg('保存失敗: ' + (err.message || err), true);
                           console.error('保存失敗', err);
                        }
                });
                    // 新增保存錯誤提示顯示區域
                    if (!document.getElementById('保存錯誤提示')) {
                        var msgDiv = document.createElement('div');
                        msgDiv.id = '保存錯誤提示';
                        msgDiv.style = 'color:red;margin:8px 0;';
                        document.querySelector('.reply-group').appendChild(msgDiv);
                    }
                    // 顯示保存訊息
                    function showSaveMsg(msg, isError) {
                        var el = document.getElementById('保存錯誤提示');
                        el.textContent = msg;
                        el.style.color = isError ? 'red' : 'green';
                        setTimeout(() => { el.textContent = ''; }, 4000);
                    }
            });
    </script>
</body>
</html>